import{_ as t,o as p,c as o,a as s,b as c,d as a,e as n,r as i}from"./app.73a0ea12.js";const l={},r=a(`<p>\u5728\u521D\u59CB\u5316\u7684 egg \u9879\u76EE <code>package.json</code> \u4E2D\u53EF\u4EE5\u770B\u5230:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>  
    <span class="token string-property property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;egg-bin dev&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;debug&quot;</span><span class="token operator">:</span> <span class="token string">&quot;egg-bin debug&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;test-local&quot;</span><span class="token operator">:</span> <span class="token string">&quot;egg-bin test&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;cov&quot;</span><span class="token operator">:</span> <span class="token string">&quot;egg-bin cov&quot;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728 <strong>egg</strong> \u9879\u76EE <code>package.json</code> \u4E2D\u770B\u5230 <code>dev</code> \u3001<code>debug</code> \u3001<code>test-local</code> \u3001<code>cov</code> \u547D\u4EE4\u90FD\u662F\u4F9D\u8D56 <strong>egg-bin</strong> \u542F\u52A8\u7684\u3002</p><h4 id="egg-bin-\u6E90\u7801\u89E3\u6790" tabindex="-1"><a class="header-anchor" href="#egg-bin-\u6E90\u7801\u89E3\u6790" aria-hidden="true">#</a> egg-bin \u6E90\u7801\u89E3\u6790</h4><p><strong>\u76EE\u5F55\u7ED3\u6784\u5982\u4E0B</strong>\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">package</span><span class="token punctuation">.</span>json
index<span class="token punctuation">.</span>js
bin
\u251C\u2500\u2500 egg<span class="token operator">-</span>bin<span class="token punctuation">.</span>js
\u251C\u2500\u2500 ets<span class="token punctuation">.</span>js
\u2514\u2500\u2500 mocha<span class="token punctuation">.</span>js
lib
\u251C\u2500\u2500 cmd
\u2502   \u251C\u2500\u2500 autod<span class="token punctuation">.</span>js
\u2502   \u251C\u2500\u2500 cov<span class="token punctuation">.</span>js
\u2502   \u251C\u2500\u2500 debug<span class="token punctuation">.</span>js
\u2502   \u251C\u2500\u2500 dev<span class="token punctuation">.</span>js
\u2502   \u251C\u2500\u2500 local<span class="token punctuation">.</span>js
\u2502   \u251C\u2500\u2500 pkgfiles<span class="token punctuation">.</span>js
\u2502   \u2514\u2500\u2500 test<span class="token punctuation">.</span>js
\u251C\u2500\u2500 command<span class="token punctuation">.</span>js
\u2514\u2500\u2500 start<span class="token operator">-</span>cluster
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><p><strong>package.json \u5165\u53E3</strong></p><p>\u5728 <strong>egg-bin</strong> \u6A21\u5757\u7684 package.json \u4E2D\u53EF\u4EE5\u770B\u5230 bin \u5165\u53E3\u6587\u4EF6\u662F <code>/bin/egg-bin.js</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token string-property property">&quot;bin&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;egg-bin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bin/egg-bin.js&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;mocha&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bin/mocha.js&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;ets&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bin/ets.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>bin/egg-bin.js</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token hashbang comment">#!/usr/bin/env node</span>

<span class="token string">&#39;use strict&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Command <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;..&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Command</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Command</strong> \u5BF9\u8C61\u6765\u81EA <code>index.js</code>, <code>index.js</code> \u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> Command <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./lib/command&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">EggBin</span> <span class="token keyword">extends</span> <span class="token class-name">Command</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">rawArgv</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>rawArgv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>usage <span class="token operator">=</span> <span class="token string">&#39;Usage: egg-bin [command] [options]&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;lib/cmd&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u52A0\u8F7D\u547D\u4EE4\u884C\u53C2\u6570\u5BF9\u5E94\u7684 js \u6587\u4EF6</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> exports <span class="token operator">=</span> EggBin<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728 <code>inde.js</code> \u4E2D\u6211\u4EEC\u770B\u5230 <strong>Command</strong> \u5BF9\u8C61\u5C31\u662F <strong>EggBin</strong> \u7C7B\uFF0C\u8BE5\u7C7B\u53C8\u7EE7\u627F\u81EA <strong>Command</strong>\uFF0C\u5173\u4E8E\u547D\u4EE4\u884C\u5B9E\u73B0\u548C\u5904\u7406\u90FD\u5728\u8BE5\u7C7B\u4E0A\u5B9E\u73B0\u7684\u3002</p><p>\u63A5\u4E0B\u6765\u8FDB\u5165 <code>./lib/command.js</code> \uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token string">&#39;use strict&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> BaseCommand <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;common-bin&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Command</span> <span class="token keyword">extends</span> <span class="token class-name">BaseCommand</span> <span class="token punctuation">{</span>
 <span class="token operator">...</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Command<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4ECE\u4EE3\u7801\u4E2D\u53EF\u4EE5\u770B\u51FA <strong>Command</strong> \u7C7B\u53C8\u7EE7\u627F\u81EA <strong>BaseCommand</strong>, \u7531\u6B64\u53D1\u73B0 <code>egg-bin</code> \u6A21\u5757\u547D\u4EE4\u7684\u5B9E\u73B0\u4F7F\u7528\u7684\u662F <code>common-bin</code> \u516C\u5171\u6A21\u5757\u3002</p>`,18),u=n("\u8FD9\u91CC\u548C\u5927\u5BB6\u7B80\u5355\u8BF4\u660E\u4E00\u4E0B common-bin \u6A21\u5757\u4F7F\u7528("),d={href:"https://github.com/zhoujingang/npmTest/tree/master/common-bin",target:"_blank",rel:"noopener noreferrer"},k=n("\u4F7F\u7528\u5B9E\u4F8B"),v=n(")\u3002 \u524D\u9762\u5728 "),m=s("strong",null,"EggBin",-1),g=n(" \u7C7B "),b=s("code",null,"constructor",-1),j=n(" \u4E2D\u8C03\u7528\u4E86 this.load \u65B9\u6CD5"),h=a(`<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;lib/cmd&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u8BE5\u65B9\u6CD5\u52A0\u8F7D\u4E86 <code>lib/cmd</code> \u76EE\u5F55\u4E0B\u7684 js \u6587\u4EF6\uFF1A</p><ul><li>autod.js</li><li>cov.js</li><li>debug.js</li><li>dev.js</li><li>pkgfiles.js</li><li>test.js</li></ul><p>\u76F8\u5F53\u4E8E\u5B9A\u4E49\u4E86 <code>autod</code>\u3001<code>cov</code>\u3001<code>debug</code>\u3001<code>dev</code>\u3001<code>pkgfiles</code>\u3001<code>test</code>\u547D\u4EE4\uFF0C\u6BD4\u5982\u5F53\u6211\u4EEC\u6267\u884C <code>npm run dev</code> \u7684\u65F6\u5019\uFF0C\u5C31\u4F1A\u6267\u884C <code>dev.js</code>\u3002 \u76F8\u5F53\u4E8E\u5728 egg-bin \u6A21\u5757\u76EE\u5F55\u6267\u884C\u4E86:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">node</span> ./bin/egg-bin.js dev
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u6240\u4EE5 <strong>Egg</strong> \u542F\u52A8 <code>npm run dev </code> \u6267\u884C\u7684\u662F <code>dev.js</code> \u6587\u4EF6\u3002</p><h4 id="dev-js-\u6E90\u7801\u89E3\u6790" tabindex="-1"><a class="header-anchor" href="#dev-js-\u6E90\u7801\u89E3\u6790" aria-hidden="true">#</a> dev.js \u6E90\u7801\u89E3\u6790</h4><p>dev.js \u4E3B\u8981\u5305\u542B\u4E09\u4E2A\u529F\u80FD</p><ol><li>\u547D\u4EE4\u884C\u53C2\u6570\u8BBE\u7F6E(\u6839\u76EE\u5F55\u3001\u7AEF\u53E3\u3001\u8FDB\u7A0B\u6570\u91CF..)</li><li>\u8FDB\u7A0B\u53C2\u6570\u683C\u5F0F\u5316(\u53C2\u6570\u4F20\u9012\u3001\u7AEF\u53E3\u63A2\u6D4B\u662F\u5426\u53EF\u7528)</li><li>\u8FDB\u7A0B\u542F\u52A8</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">DevCommand</span> <span class="token keyword">extends</span> <span class="token class-name">Command</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">rawArgv</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">// \u547D\u4EE4\u884C\u53C2\u6570\u8BBE\u7F6E</span>
      <span class="token operator">...</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token operator">*</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token keyword">const</span> task <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>helper<span class="token punctuation">.</span><span class="token function">forkNode</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>serverBin<span class="token punctuation">,</span> devArgs<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// \u8FDB\u7A0B\u542F\u52A8</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
  
  <span class="token operator">*</span> <span class="token function">formatArgs</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//\u8FDB\u7A0B\u542F\u52A8\u53C2\u6570\u683C\u5F0F\u5316</span>
    <span class="token operator">...</span>
      <span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">detect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>defaultPort<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> DevCommand<span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FDB\u7A0B\u5728\u542F\u52A8\u4E4B\u524D\u7684\u53C2\u6570\uFF0C\u4E5F\u5C31\u662F <code>formatArgs</code> \u65B9\u6CD5\u7684\u8FD4\u56DE\u503C\uFF0C\u8C03\u5F0F\u8F93\u51FA\u5982\u4E0B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token operator">...</span>
  <span class="token literal-property property">tscompiler</span><span class="token operator">:</span> <span class="token string">&#39;ts-node/register&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">workers</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// \u8FDB\u7A0B\u6570\u91CF</span>
  <span class="token literal-property property">baseDir</span><span class="token operator">:</span> <span class="token string">&#39;/Users/***/study/eggStudy/egg-bin&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u5F53\u524D\u8FDB\u7A0B\u6839\u76EE\u5F55</span>
  <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">7001</span><span class="token punctuation">,</span> <span class="token comment">//\u7AEF\u53E3</span>
  <span class="token literal-property property">framework</span><span class="token operator">:</span> <span class="token string">&#39;/Users/***/study/eggStudy/egg-bin/node_modules/egg&#39;</span> <span class="token comment">//\u6846\u67B6\u76EE\u5F55</span>
<span class="token punctuation">}</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u542F\u52A8\u8FDB\u7A0B\u662F\u6267\u884C <em><code>this.helper.forkNode</code></em> , \u6700\u5F00\u59CB\u6211\u4EE5\u4E3A <code>this.helper.forkNode</code> \u65B9\u6CD5\u662F <strong>EggBin</strong> \u7C7B\u4E0A\u9762\u7684\u65B9\u6CD5\uFF0C\u6E90\u7801\u7FFB\u4E00\u904D\u4E5F\u6CA1\u627E\u5230\uFF0C\u540E\u6765\u53D1\u73B0\u8BE5\u65B9\u6CD5\u662F <code>common-bin</code> \u6A21\u5757\u7684\u65B9\u6CD5\uFF0C\u7528\u6765 fork \u4E00\u4E2A\u5B50\u8FDB\u7A0B\u3002<em><code>this.serverBin</code></em> \u53C2\u6570\u5C31\u662F\u6267\u884C\u6587\u4EF6,\u8BE5\u53C2\u6570\u5C31\u662F <code>lib/start-cluster</code> \u6587\u4EF6\u3002</p><p>start-cluster \u6587\u4EF6\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">require</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>framework<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startCluster</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u4ECE <code>npm run dev</code> \u5F00\u59CB\u6267\u884C\u4E00\u7CFB\u5217\u4EE3\u7801\u540E\uFF0C\u6700\u7EC8\u8D70\u8FDB\u4E86 <code>start-cluster</code> \u4E2D\u7684\u4EE3\u7801\uFF0C <strong>egg-bin</strong> \u6A21\u5757\u7684\u4EFB\u52A1\u5C31\u7ED3\u675F\u4E86\u3002</p><p>\u540E\u7EED\u5C06\u4E3A\u5927\u5BB6\u89E3\u6790\u91CD\u70B9\u6A21\u5757 \u2014\u2014 <strong>egg-cluster</strong></p>`,17);function y(f,_){const e=i("ExternalLinkIcon");return p(),o("div",null,[r,s("p",null,[u,s("a",d,[k,c(e)]),v,m,g,b,j]),h])}var w=t(l,[["render",y],["__file","egg-bin.html.vue"]]);export{w as default};
